<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="DSZ" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="sql架构与存储引擎Qps与Tps​                TPS: 指服务器每秒处理的事务数 ，支持事务的存储引擎特有的一个性能指标 TPS = (事务提交+事务回滚）&#x2F;运行时间​                QPS:执行sql等待返回结果之间的等待时间QPS=查询个数&#x2F;运行时间mysqlslap">
<meta name="keywords" content="底层深入">
<meta property="og:type" content="article">
<meta property="og:title" content="sql优化相关之如何写出一条好sql">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;05&#x2F;18&#x2F;sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql&#x2F;index.html">
<meta property="og:site_name" content="DSZ">
<meta property="og:description" content="sql架构与存储引擎Qps与Tps​                TPS: 指服务器每秒处理的事务数 ，支持事务的存储引擎特有的一个性能指标 TPS = (事务提交+事务回滚）&#x2F;运行时间​                QPS:执行sql等待返回结果之间的等待时间QPS=查询个数&#x2F;运行时间mysqlslap">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;05&#x2F;18&#x2F;sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql&#x2F;1589769109015.png">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;05&#x2F;18&#x2F;sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql&#x2F;C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589770015142.png">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;05&#x2F;18&#x2F;sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql&#x2F;C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589770451852.png">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;05&#x2F;18&#x2F;sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql&#x2F;C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589773241899.png">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image002.jpg">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image002.jpg">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image004.jpg">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image002.jpg">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image004.jpg">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image006.jpg">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image002.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;05&#x2F;18&#x2F;sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql&#x2F;C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589872072524.png">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;05&#x2F;18&#x2F;sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql&#x2F;C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589872083937.png">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image002.jpg">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image004.jpg">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image006.jpg">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image008.jpg">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image010.jpg">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image012.jpg">
<meta property="og:image" content="file:&#x2F;&#x2F;&#x2F;C:&#x2F;Users&#x2F;dsz&#x2F;AppData&#x2F;Local&#x2F;Temp&#x2F;msohtmlclip1&#x2F;01&#x2F;clip_image014.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;05&#x2F;18&#x2F;sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql&#x2F;C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589883497088.png">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;05&#x2F;18&#x2F;sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql&#x2F;C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589883858311.png">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;05&#x2F;18&#x2F;sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql&#x2F;C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589884184701.png">
<meta property="og:updated_time" content="2020-05-22T08:37:49.779Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;05&#x2F;18&#x2F;sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql&#x2F;1589769109015.png">

<link rel="canonical" href="http://yoursite.com/2020/05/18/sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>sql优化相关之如何写出一条好sql | DSZ</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?895fe3569ca62ef46b482bd4f34feee7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">DSZ</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">与其临渊羡鱼， 不如退而结网。</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-fw fa-sitemap"></i>站点地图</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/18/sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/dsz.jpeg">
      <meta itemprop="name" content="DSZ">
      <meta itemprop="description" content="机会是留给有准备的人的。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DSZ">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          sql优化相关之如何写出一条好sql
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-18 09:02:36" itemprop="dateCreated datePublished" datetime="2020-05-18T09:02:36+08:00">2020-05-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-22 16:37:49" itemprop="dateModified" datetime="2020-05-22T16:37:49+08:00">2020-05-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="sql架构与存储引擎"><a href="#sql架构与存储引擎" class="headerlink" title="sql架构与存储引擎"></a>sql架构与存储引擎</h2><h3 id="Qps与Tps"><a href="#Qps与Tps" class="headerlink" title="Qps与Tps"></a>Qps与Tps</h3><p>​                TPS: 指服务器每秒处理的事务数 ，<strong>支持事务的存储引擎</strong>特有的一个性能指标 </p><p>TPS = (事务提交+事务回滚）/运行时间</p><p>​                QPS:执行sql等待返回结果之间的等待时间</p><p>QPS=查询个数/运行时间</p><h3 id="mysqlslap"><a href="#mysqlslap" class="headerlink" title="mysqlslap"></a>mysqlslap</h3><a id="more"></a>



<p>MySQLSlap是从MySQL5.1.4版本就开始的官方提供的压力测试工具，能测试MySQL服务器的性能</p>
<h3 id="MySQL逻辑架构"><a href="#MySQL逻辑架构" class="headerlink" title="MySQL逻辑架构"></a>MySQL逻辑架构</h3><p>​    <strong>连接层</strong></p>
<p>MySQL启动时 MySQL自己会创建一个线程 每一个用户对MySQL进行连接时，服务器都会新建一个线程去处理这一个连接，每个线程都是独立的 但是如果有两个线程进行修改同一块内存时会引发数据同步问题</p>
<p><img src="/2020/05/18/sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql/1589769109015.png" alt="1589769109015"></p>
<p><strong>sql处理层</strong></p>
<p>sql语句的解析，优化，缓存的查询 MySQL内置函数的实现等</p>
<p>1，如果是查询语句select，首先会查询缓存是否已经有对应的结果，有返回结果 没有的话进行下一步 </p>
<p>2，解析查询，创建一个内部数据结构这个解析树用于解析SQL语法</p>
<p>3，优化sql语句，列如重写查询，决定表的读写顺序以及选择需要的查询等，这一阶段用户是可以查询的，用户可以针对的进行一个调优</p>
<p><img src="/2020/05/18/sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql/C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589770015142.png" alt="1589770015142"></p>
<p><strong>sql缓存</strong></p>
<p>show variables like ‘%query_cache_type%’ </p>
<p>查询数据库缓存是否开启</p>
<p><strong>sql转换器</strong></p>
<p>将传输进来的sql语句转换成MySQL能看得懂的样子</p>
<p><img src="/2020/05/18/sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql/C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589770451852.png" alt="1589770451852"></p>
<p><strong>sql优化器</strong></p>
<p>能够优化一些MySQL中很明显得一些冗余代码 （列如 1=1），使得代码变得更加简单</p>
<h3 id="mylsam存储引擎"><a href="#mylsam存储引擎" class="headerlink" title="mylsam存储引擎"></a>mylsam存储引擎</h3><p><strong>文件结构</strong></p>
<ul>
<li>frm //存储表结构，所有得引擎都具备</li>
<li>myd  //数据文件</li>
<li>myi //索引文件</li>
</ul>
<p><strong>mysam特点</strong></p>
<ul>
<li>并发性与锁级别-表级锁</li>
<li>支持全文检索</li>
<li>支持数据压缩</li>
<li>myisampack -d -f testmysam.myl  文件压缩指令</li>
</ul>
<p><strong>mysam适用场景</strong></p>
<ul>
<li>非事务型应用（数据仓库，报表，日志数据）</li>
<li>只读类应用</li>
<li>空间类应用（地图等应用 更好得计算函数）</li>
</ul>
<h3 id="innodb存储引擎"><a href="#innodb存储引擎" class="headerlink" title="innodb存储引擎"></a><strong>innodb存储引擎</strong></h3><p>innodb是MySQL在5.5以后版本的默认数据库</p>
<p>innodb_file_per_table  属性 no代表独立表空间 off代表系统表空间 on的时候会创建一个.ibd文件 内容是（数据+索引）mysql5.6以前都是默认系统表空间</p>
<p>比较：</p>
<ul>
<li>系统表空间无法简单的收缩文件大小（所以占用磁盘内存会越来越大）</li>
<li>独立表空间可以通过optimize table收缩系统文件</li>
<li>系统表空间会产生io瓶颈</li>
<li>独立表空间可以同时向多个文件刷新数据</li>
</ul>
<p>（列如一张表有100w条数据占用磁盘内存 100000kb 当你把表中数据清除时 他在磁盘的占用内存还是 100000kb 无法收缩文件大小）</p>
<p><img src="/2020/05/18/sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql/C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589773241899.png" alt="1589773241899"></p>
<p><strong>适用场景</strong>：</p>
<p>修改较多，事务操作较多的场景</p>
<h3 id="CSV存储引擎"><a href="#CSV存储引擎" class="headerlink" title="CSV存储引擎"></a>CSV存储引擎</h3><p>​    <strong>结构</strong></p>
<ul>
<li>​        数据以文本的方式存储在文件</li>
<li>​        .csv文件存储内容</li>
<li>​        .csm文件存储表的元数据如表的状态数据量等</li>
<li>​        .frm表结构</li>
</ul>
<p>​    <strong>特点</strong></p>
<ul>
<li>以csv格式进行数据存储 所有的列都不能为null 不支持索引 （不适合大表，不适合在线处理）</li>
<li>可以对数据文件直接编辑（保存文本文件内容）</li>
<li>修改文件以后运行FLUSH TABLES进行刷新</li>
<li>列的最后得有一个空行</li>
</ul>
<h3 id="Archive存储引擎"><a href="#Archive存储引擎" class="headerlink" title="Archive存储引擎"></a>Archive存储引擎</h3><p><strong>组成</strong></p>
<p>以zlib对表数据进行压缩，磁盘i/o更少数据存储在ARZ为后缀的文件中</p>
<p><strong>特点</strong></p>
<ul>
<li>只支持insert和select操作</li>
<li>只允许在自增ID列上加索引</li>
</ul>
<p><strong>使用场景</strong></p>
<p>日志和数据采集应用</p>
<h3 id="Memory-存储引擎"><a href="#Memory-存储引擎" class="headerlink" title="Memory 存储引擎"></a>Memory 存储引擎</h3><p><strong>特点</strong></p>
<ul>
<li>文件系统存储特点</li>
<li>支持hash索引和btree索引</li>
<li>所有字段都是固定长度</li>
<li>不支持blog和text等大字段</li>
<li>Memory存储引擎使用表级锁</li>
<li>最大大小由max_heap_table_size参数决定</li>
<li>数据存储到内存当中</li>
</ul>
<p><strong>使用场景</strong></p>
<ul>
<li><p>hash索引用于查找或者是映射表</p>
</li>
<li><p>用于保存数据分析中产生的中间表</p>
</li>
<li><p>用于缓存周期性聚合数据的结果表<br>注意：memory数据易丢失，所以要求数据可再生</p>
</li>
</ul>
<h3 id="Ferderated-存储引擎"><a href="#Ferderated-存储引擎" class="headerlink" title="Ferderated 存储引擎"></a>Ferderated 存储引擎</h3><p><strong>特点</strong></p>
<ul>
<li>提供了访问远程MySQL服务器上表的方法</li>
<li>本地不存储数据，数据全部放到远程服务器上</li>
<li>本地需要保存表结构和远程服务器的连接信息</li>
</ul>
<p><strong>使用场景</strong></p>
<ul>
<li>偶尔的统计分析及手工查询</li>
</ul>
<h2 id="sql锁机制"><a href="#sql锁机制" class="headerlink" title="sql锁机制"></a>sql锁机制</h2><h3 id="MySQL中的锁"><a href="#MySQL中的锁" class="headerlink" title="MySQL中的锁"></a><strong>MySQL中的锁</strong></h3><p>​        表级锁：开销小，加锁快，不会出现死锁，锁定粒度大，发生锁冲突的概率较高，并发低 常见表级锁的存储引擎有mylsam 表级锁更加适合以查询为主的场景  </p>
<p>​        行级锁: 开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度高，常见的行级锁存储引擎有innodb 更适合有修改操作的事务场景</p>
<h3 id="myisam的表锁"><a href="#myisam的表锁" class="headerlink" title="myisam的表锁"></a>myisam的表锁</h3><h4 id="读锁"><a href="#读锁" class="headerlink" title="读锁"></a><strong>读锁</strong></h4><p><strong>加共享读锁</strong> lock table 表名 read</p>
<p><strong>测试</strong></p>
<ol>
<li>lock table testmysam READ 启动另外一个session select * from<br>testmysam 可以查询</li>
<li>insert into testmysam value(2);<br>update testmysam set id=2 where id=1;<br>报错</li>
<li>在另外一个session中<br> insert into testmysam value(2); 等待</li>
<li>在同一个session中<br> insert into testdemo value(2,’2’,’3’); 报错<br> select * from testdemo ; 报错</li>
<li>在另外一个session中<br> insert into testdemo value(2,’2’,’3’); 成功</li>
<li>加索在同一个session 中 select s.* from testmysam s 报错<br> lock table 表名 as 别名 read;</li>
<li>查看 show status LIKE ‘table_locks_waited’ 表被锁过几次 </li>
<li>UNLOCK TABLES  删除锁</li>
</ol>
<h4 id="写锁"><a href="#写锁" class="headerlink" title="写锁"></a><strong>写锁</strong></h4><p><strong>加独占写锁</strong> lock table 表名 write</p>
<p><strong>测试</strong></p>
<ol>
<li>lock table testmysam WRITE<br>在同一个session中<br>insert testmysam value(3);<br>delete from testmysam where id = 3<br>select * from testmysam</li>
<li>对不同的表操作（ 报错）<br>select s.* from testmysam s<br>insert into testdemo value(2,’2’,’3’);</li>
<li>在其他session中 （ 等待）<br>select * from testmysam </li>
</ol>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>对myisam表的读操作，不会阻塞其他用户对同一表的读请求，但会阻塞对同一表的写请求</li>
<li>对myisam表的读操作，不会阻塞但前session对表读，当对表进行修改会保存</li>
<li>一个session使用LOCK TABLE命令给表f加了读锁，这个session可以查询锁定表中的记录，但更新或访问其他表都会提示错误</li>
<li>另外一个session可以查询表中的记录，但更新就会出现锁等待</li>
<li>对myisam表的写操作，则会阻塞其他用户对同一表的读和写操作</li>
<li>对myisam表的写操作，当前session可以对本表做crud，但对其他表进行操作就会报错</li>
</ul>
<h3 id="innoDB行锁"><a href="#innoDB行锁" class="headerlink" title="innoDB行锁"></a>innoDB行锁</h3><p><strong>行锁简介</strong></p>
<p>共享锁又称：读锁，当一个事务对某几行上读锁时，允许其他事务对这几行进行读操作，但不允许其进行写操作，也不允许其他事务给这几行上排它锁，但允许上读锁</p>
<p>排他锁又称：写锁。当一个事务对某几个上写锁时，不允许其他事务写，但允许读，更不允许其他事务给这几行上任何锁，包括写锁。</p>
<p><strong>语法</strong>：</p>
<p>上共享锁的写法：lock in share mode </p>
<p>列如：select * from 表 where 条件 lock in share mode </p>
<p>上排他锁的写法： for update</p>
<p>列如： select * from 表 where 条件 for update </p>
<p><strong>注意：</strong></p>
<ol>
<li>两个事务不能锁同一个索引</li>
<li>insert，delete，update 在事务中都会自动默认加上排他锁</li>
<li>行锁必须有索引才能实现，否则会自动锁全表，那么就不是行锁了</li>
</ol>
<p><strong>测试：</strong></p>
<ol>
<li><p>BEGIN<br>select * from testdemo where id =1 for update<br>在另外一个session中<br>update testdemo set c1 = ‘1’ where id = 2 成功<br>update testdemo set c1 = ‘1’ where id = 1 等待</p>
</li>
<li><p>BEGIN<br>update testdemo set c1 = ‘1’ where id = 1<br>在另外一个session中<br>update testdemo set c1 = ‘1’ where id = 1 等待</p>
</li>
<li><p>BEGIN</p>
<p>update testdemo set c1 = ‘1’ where  c1 = ‘1’ 在另外一个session中 update testdemo set c1 = ‘2’ where c1 = ‘2’ 等待</p>
</li>
</ol>
<p><strong>先来看下行锁</strong><br>第一个session中<br>select * from testdemo where id =1 for update<br>第二个session<br>select * from testdemo where id =1 lock in share mode<br>回到第一个session UNLOCK TABLES 并不会解锁<br>使用commit 或者 begin或者ROLLBACK 才会解锁</p>
<p><strong>再来看下表锁</strong><br>lock table testdemo WRITE<br>使用commit， ROLLBACK 并不会解锁<br>使用UNLOCK TABLES 或者begin会解锁 </p>
<h2 id="sql事务"><a href="#sql事务" class="headerlink" title="sql事务"></a>sql事务</h2><h3 id="事务的特性"><a href="#事务的特性" class="headerlink" title="事务的特性"></a>事务的特性</h3><p>事务有4个属性：原子性，一致性，隔离性，持久性。简称为ACID特性</p>
<ul>
<li>原子性：一组事务要么全部成功要么全部失败</li>
<li>一致性：事务前后的数据不可以丢失不可以不一致</li>
<li>隔离性：一个事务不能被另一个事务所干扰，即并发执行的各个事务之间不能互相干扰。</li>
<li>持久性：一个事务一旦提交 其对数据的改变就必须是永久性的</li>
</ul>
<h3 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h3><p>事务有四种隔离级别</p>
<ul>
<li>​    读未提交   可能会产生脏读问题</li>
<li>​    读已提交   可能会产生不可重复读问题</li>
<li>​    可重复读  可以对产生幻读问题</li>
<li>​    可串行化   </li>
</ul>
<p>MySQL的默认隔离级别为可重复读</p>
<p><strong>并发问题</strong></p>
<ul>
<li>脏读：事务a读取到了事务b更新的数据，然后b进行了回滚操作 导致a读到的数据并不准确</li>
<li>不可重复读： 事务A多次读取一个数据，事务b在事务a读取时进行了更新操作，但是由于事务a读取的还是未进行更新的数据，所以事务A读取的数据并不准确</li>
<li>幻读：事务A开启事务准备往表里插入一条数据，而事务B也一样</li>
</ul>
<p><strong>事务的语法</strong></p>
<ul>
<li>开启事务<ol>
<li>start transaction</li>
<li>begin work</li>
<li>begin</li>
</ol>
</li>
<li>事务回滚 rollback</li>
<li>事务提交 commit</li>
<li>还原点 savepoint</li>
</ul>
<p><strong>总结</strong></p>
<p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg" alt="img"></p>
<p><strong>事务隔离级别为可重复读时，如果有索引（包括主键索引）的时候，以索引列为条件更新数据，会存在间隙锁间、行锁、页锁的问题，从而锁住一些行；如果没有索引，更新数据时会锁住整张表</strong></p>
<p><strong>事务隔离级别为串行化时，读写数据都会锁住整张表</strong></p>
<p><strong>隔离级别越高，越能保证数据的完整性和一致性，但是对并发性能的影响也越大，对于多数应用程序，可以优先考虑把数据库系统的隔离级别设为Read Committed**</strong>，它能够避免脏读取，而且具有较好的并发性能。**</p>
<h2 id="sql业务设计"><a href="#sql业务设计" class="headerlink" title="sql业务设计"></a>sql业务设计</h2><h3 id="范式设计-三大范式"><a href="#范式设计-三大范式" class="headerlink" title="范式设计 三大范式"></a>范式设计 三大范式</h3><p><strong>第一范式</strong></p>
<p>数据库表中的所有字段都只具有单一属性</p>
<p>单一属性的列是由基本数据类型所构成的</p>
<p>设计出来的表都是简单的二维表</p>
<p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg" alt="img"> </p>
<p>name-age列具有两个属性，一个name,一个 age不符合第一范式，把它拆分成两列</p>
<p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg" alt="img"></p>
<p><strong>第二范式</strong></p>
<p>要求表中只具有一个业务主键，也就是说符合第二范式的表不能存在非主键列只对部分主键的依赖关系</p>
<p>有两张表：订单表，产品表</p>
<p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg" alt="img"></p>
<p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg" alt="img"></p>
<p>一个订单有多个产品，所以订单的主键为【订单ID】和【产品ID】组成的联合主键，这样2个组件不符合第二范式，而且产品ID和订单ID没有强关联，故，把订单表进行拆分为订单表与订单与商品的中间表</p>
<p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg" alt="img"></p>
<p><strong>第三范式</strong></p>
<p>指每一个非非主属性既不部分依赖于也不传递依赖于业务主键，也就是在第二范式的基础上相处了非主键对主键的传递依赖</p>
<p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg" alt="img"></p>
<p>其中</p>
<p><strong>客户编号</strong> <strong>和订单编号管理</strong> <strong>关联</strong></p>
<p><strong>客户姓名</strong> <strong>和订单编号管理</strong> <strong>关联</strong></p>
<p><strong>客户编号</strong> <strong>和</strong> <strong>客户姓名</strong> <strong>关联</strong></p>
<p>如果客户编号发生改变，用户姓名也会改变，这样不符合第三大范式，应该<strong>把客户姓名这一列删除</strong></p>
<h3 id="反范式设计"><a href="#反范式设计" class="headerlink" title="反范式设计"></a>反范式设计</h3><h4 id="什么叫反范式化设计"><a href="#什么叫反范式化设计" class="headerlink" title="什么叫反范式化设计"></a>什么叫反范式化设计</h4><ul>
<li>反范式化是针对范式化而言得，在前面介绍了数据库设计得范式</li>
<li>所谓得反范式化就是为了性能和读取效率得考虑而适当得对数据库设计范式得要求进行违反</li>
<li>允许存在少量得冗余，换句话来说反范式化就是使用空间来换取时间</li>
</ul>
<p>商品信息反范式设计</p>
<p>下面是范式设计的商品信息表</p>
<p><img src="/2020/05/18/sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql/C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589872072524.png" alt="1589872072524"></p>
<p>商品信息和分类信息经常一起查询，所以把分类信息也放到商品表里面，冗余存放</p>
<p>在线销售功能反范式</p>
<p>下面是在线手写功能的范式设计</p>
<p><img src="/2020/05/18/sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql/C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589872083937.png" alt="1589872083937"></p>
<p> 范式化设计优缺点</p>
<p>优点：</p>
<p>  可以尽量得减少数据冗余</p>
<p>  范式化的更新操作比反范式化更快</p>
<p>  范式化的表通常比反范式化的表更小</p>
<p>缺点：</p>
<p>   对于查询需要对多个表进行关联</p>
<p>   更难进行索引优化 </p>
<h4 id="反范式化设计优缺点"><a href="#反范式化设计优缺点" class="headerlink" title="反范式化设计优缺点"></a>反范式化设计优缺点</h4><p>优点：</p>
<p> 可以减少表的关联</p>
<p>可以更好的进行索引优化</p>
<p>缺点：</p>
<p>  存在数据冗余及数据维护异常</p>
<p>  对数据的修改需要更多的成本</p>
<h2 id="物理设计"><a href="#物理设计" class="headerlink" title="物理设计"></a>物理设计</h2><h3 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h3><p>数据库、表、字段的命名要遵守可读性原则</p>
<p>使用大小写来格式化的库对象名字以获得良好的可读性</p>
<p>例如：使用custAddress而不是custaddress来提高可读性。</p>
<p>数据库、表、字段的命名要遵守表意性原则</p>
<p>对象的名字应该能够描述它所表示的对象</p>
<p>例如：</p>
<p>对于表，表的名称应该能够体现表中存储的数据内容；对于存储过程</p>
<p>存储过程应该能够体现存储过程的功能。</p>
<p>数据库、表、字段的命名要遵守长名原则</p>
<p>尽可能少使用或者不使用缩写</p>
<h3 id="存储引擎选择"><a href="#存储引擎选择" class="headerlink" title="存储引擎选择"></a>存储引擎选择</h3><p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg" alt="img"></p>
<h3 id="数据类型选择"><a href="#数据类型选择" class="headerlink" title="数据类型选择"></a>数据类型选择</h3><p>当一个列可以选择多种数据类型时</p>
<p>l  优先考虑数字类型</p>
<p>l  其次是日期、时间类型</p>
<p>l  最后是字符类型</p>
<p>l  对于相同级别的数据类型，应该优先选择占用空间小的数据类型</p>
<p>浮点类型</p>
<p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg" alt="img"></p>
<p>注意float 和double 是非精度类型，如果是和金额相关尽量用decimal</p>
<p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg" alt="img"></p>
<p>select sum(c1),sum(c2),sum(c3) from test_numberic</p>
<p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image008.jpg" alt="img"></p>
<p>日期类型</p>
<p>面试经常问道 timestamp 类型 与 datetime区别</p>
<p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image010.jpg" alt="img"></p>
<p>datetime类型在5.6中字段长度是5个字节</p>
<p>datetime类型在5.5中字段长度是8个字节</p>
<p><strong>timestamp</strong> <strong>和时区有关，而datetime**</strong>无关**</p>
<p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image012.jpg" alt="img"></p>
<p>insert into  test_time  VALUES(NOW(),NOW(),NOW());</p>
<p>set time_zone=”-10:00”</p>
<p><img src="file:///C:/Users/dsz/AppData/Local/Temp/msohtmlclip1/01/clip_image014.jpg" alt="img"></p>
<h2 id="sql慢查询"><a href="#sql慢查询" class="headerlink" title="sql慢查询"></a>sql慢查询</h2><h3 id="什么是慢查询"><a href="#什么是慢查询" class="headerlink" title="什么是慢查询"></a>什么是慢查询</h3><p>慢查询日志，顾名思义，就是查询慢的日志，是指mysql记录所有执行超过long_query_time参数设定的时间阈值的SQL语句的日志。该日志能为SQL语句的优化带来很好的帮助。默认情况下，慢查询日志是关闭的，要使用慢查询日志功能，首先要开启慢查询日志功能。（也就是说 把查询慢的SQL写到一个日志中）</p>
<p> 1.1.1.    慢查询基本配置</p>
<ul>
<li><p>slow_query_log 启动停止技术慢查询日志</p>
</li>
<li><p>slow_query_log_file 指定慢查询日志得存储路径及文件（默认和数据文件放一起）</p>
</li>
<li><p>long_query_time 指定记录慢查询日志SQL执行时间得伐值（单位：秒，默认10秒）</p>
</li>
<li><p>log_queries_not_using_indexes  是否记录未使用索引的SQL</p>
</li>
<li><p>log_output 日志存放的地方【TABLE】【FILE】【FILE,TABLE】</p>
</li>
</ul>
<p>配置了慢查询后，它会记录符合条件的SQL</p>
<p>包括：</p>
<ol>
<li><p>查询语句</p>
</li>
<li><p>数据修改语句</p>
</li>
<li><p>已经回滚得SQL </p>
</li>
</ol>
<p><strong>实操：</strong></p>
<p>通过下面命令查看下上面的配置：</p>
<p>show VARIABLES like ‘%slow_query_log%’</p>
<p>show VARIABLES like ‘%slow_query_log_file%’ </p>
<p>show VARIABLES like ‘%long_query_time%’ </p>
<p>show VARIABLES like ‘%log_queries_not_using_indexes%’ </p>
<p>show VARIABLES like ‘log_output’  </p>
<p>set global long_query_time=0;   —默认10秒，这里为了演示方便设置为0  </p>
<p>set GLOBAL  slow_query_log = 1; –开启慢查询日志 </p>
<p>set global log_output=’FILE,TABLE’  –项目开发中日志只能记录在日志文件中，不能记表中  </p>
<p>设置完成后，查询一些列表可以发现慢查询的日志文件里面有数据了。</p>
<h3 id="1-1-1-慢查询基本配置"><a href="#1-1-1-慢查询基本配置" class="headerlink" title="1.1.1.    慢查询基本配置"></a>1.1.1.    慢查询基本配置</h3><ul>
<li>slow_query_log 启动停止技术慢查询日志</li>
<li>slow_query_log_file 指定慢查询日志得存储路径及文件（默认和数据文件放一起）</li>
<li>long_query_time 指定记录慢查询日志SQL执行时间得伐值（单位：秒，默认10秒）</li>
<li>log_queries_not_using_indexes  是否记录未使用索引的SQL</li>
<li>log_output 日志存放的地方【TABLE】【FILE】【FILE,TABLE】</li>
</ul>
<p>配置了慢查询后，它会记录符合条件的SQL</p>
<p>包括：</p>
<ul>
<li>查询语句</li>
<li>数据修改语句</li>
<li>已经回滚得SQL </li>
</ul>
<p><strong>实操：</strong></p>
<p><strong>通过下面命令查看下上面的配置：</strong></p>
<ul>
<li>show VARIABLES like ‘%slow_query_log%’</li>
<li>show VARIABLES like ‘%slow_query_log_file%’</li>
<li>show VARIABLES like ‘%long_query_time%’</li>
<li>show VARIABLES like ‘%log_queries_not_using_indexes%’</li>
<li>show VARIABLES like ‘log_output’</li>
<li>set global long_query_time=0;   —默认10秒，这里为了演示方便设置为0 </li>
<li>set GLOBAL  slow_query_log = 1; –开启慢查询日志</li>
<li>set global log_output=’FILE,TABLE’  –项目开发中日志只能记录在日志文件中，不能记表中</li>
</ul>
<p>设置完成后，查询一些列表可以发现慢查询的日志文件里面有数据了。</p>
<p><strong>Mysqldumpslow</strong></p>
<p>常用的慢查询日志分析工具，汇总除查询条件外其他完全相同的SQL，并将分析结果按照参数中所指定的顺序输出。</p>
<p><strong>语法：</strong></p>
<p>mysqldumpslow -s r -t 10 slow-mysql.log</p>
<p>-s order (c,t,l,r,at,al,ar) </p>
<p>​         c:总次数</p>
<p>​         t:总时间</p>
<p>​         l:锁的时间</p>
<p>​         r:总数据行</p>
<p>​         at,al,ar  :t,l,r平均数  【例如：at = 总时间/总次数】</p>
<p>  -t  top   指定取前面几天作为结果输出</p>
<p> //运行指令</p>
<p>mysqldumpslow.pl -s t -t 10 D:\DESKTOP-2EKGEE5-slow.log </p>
<h2 id="sql索引与执行计划"><a href="#sql索引与执行计划" class="headerlink" title="sql索引与执行计划"></a>sql索引与执行计划</h2><h3 id="生活中的索引"><a href="#生活中的索引" class="headerlink" title="生活中的索引"></a>生活中的索引</h3><p>MySQL官方对索引的定义为：索引（Index）是帮助MySQL高效获取数据的数据结构。</p>
<p>可以得到索引的本质：<strong>索引是数据结构</strong>。</p>
<p>上面的理解比较抽象，举一个例子，平时看任何一本书，首先看到的都是目录，通过目录去查询书籍里面的内容会非常的迅速。</p>
<h3 id="MySql中的索引"><a href="#MySql中的索引" class="headerlink" title="MySql中的索引"></a>MySql中的索引</h3><p><img src="/2020/05/18/sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql/C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589883497088.png" alt="1589883497088"></p>
<p>MySql中的索引其实也是这么一回事，我们可以在数据库中建立一系列的索引，比如创建主键的时候默认会创建主键索引，上图是一种BTREE的索引。每一个节点都是主键的ID</p>
<p>当我们通过ID来查询内容的时候，首先去查索引库，在到索引库后能快速的定位索引的具体位置。</p>
<h3 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h3><p><strong>普通索引：</strong>即一个索引只包含单个列，一个表可以有多个单列索引</p>
<p><strong>唯一索引：</strong>索引列的值必须唯一，但允许有空值</p>
<p><strong>复合索引：</strong>即一个索引包含多个列 </p>
<p><strong>聚簇索引(聚集索引)</strong>：并不是一种单独的索引类型，而是一种数据存储方式。具体细节取决于不同的实现，InnoDB的聚簇索引其实就是在同一个结构中保存了B-Tree索引(技术上来说是B+Tree)和数据行。 </p>
<p><strong>非聚簇索引：</strong>不是聚簇索引，就是非聚簇索引</p>
<h3 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h3><p><strong>查看索引</strong></p>
<p>SHOW INDEX FROM table_name\G</p>
<p><strong>创建索引</strong></p>
<p>CREATE  [UNIQUE ] INDEX indexName ON mytable(columnname(length));</p>
<p>ALTER TABLE 表名 ADD  [UNIQUE ]  INDEX [indexName] ON (columnname(length)) </p>
<p><strong>删除索引</strong></p>
<p>DROP INDEX [indexName] ON mytable;</p>
<h3 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h3><p><strong>什么是执行计划</strong></p>
<p> 使用EXPLAIN关键字可以模拟优化器执行SQL查询语句，从而知道MySQL是</p>
<p>如何处理你的SQL语句的。分析你的查询语句或是表结构的性能瓶颈</p>
<p><strong>执行计划的作用</strong></p>
<ul>
<li>表的读取顺序</li>
<li>数据读取操作的操作类型</li>
<li>哪些索引可以使用</li>
<li>哪些索引被实际使用</li>
<li>表之间的引用</li>
<li>每张表有多少行被优化器查询</li>
</ul>
<p><strong>执行计划的语法</strong></p>
<p>执行计划的语法其实非常简单： 在SQL查询的前面加上EXPLAIN关键字就行。</p>
<p>比如：EXPLAIN select * from table1 </p>
<p>重点的就是EXPLAIN后面你要分析的SQL语句 </p>
<h4 id="执行计划详解"><a href="#执行计划详解" class="headerlink" title="执行计划详解"></a><strong>执行计划详解</strong></h4><p>通过EXPLAIN关键分析的结果由以下列组成，接下来挨个分析每一个列</p>
<p><img src="/2020/05/18/sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql/C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589883858311.png" alt="1589883858311"></p>
<p><strong>1. ID列</strong></p>
<p>ID列：描述select查询的序列号,包含一组数字，表示查询中执行select子句或操作表的顺序</p>
<p>根据ID的数值结果可以分成一下三种情况</p>
<ul>
<li>id相同：执行顺序由上至下  （按照表在sql语句中的排列顺序进行加载）</li>
<li>id不同：如果是子查询，id的序号会递增，id值越大优先级越高，越先被执行（如果是子查询，id的序号会递增，id值越大优先级越高，越先被执行）</li>
<li>id相同不同：同时存在（id如果相同，可以认为是一组，从上往下顺序执行；在所有组中，id值越大，优先级越高，越先执行）</li>
</ul>
<p><strong>2. select_type列</strong></p>
<p>Select_type：查询的类型</p>
<p>用于区别：普通查询、联合查询、子查询等的复杂查询</p>
<p>类型如下</p>
<p><img src="/2020/05/18/sql%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E4%B9%8B%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E6%9D%A1%E5%A5%BDsql/C:%5CUsers%5Cdsz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1589884184701.png" alt="1589884184701"></p>
<p><strong>3.table列</strong></p>
<p>显示这一行数据是关于那张表从那张表而来的</p>
<p><strong>4.Type列</strong></p>
<p>type显示的是访问类型，是较为重要的一个指标，结果值从最好到最坏依次是：</p>
<p>system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL </p>
<p>需要记忆的</p>
<p>system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL</p>
<p>一般来说，得保证查询至少达到range级别，最好能达到ref。</p>
<p><strong>属性解析：</strong></p>
<p>System：表只有一行记录（等于系统表），这是const类型的特列，平时不会出现，这个也可以忽略不计</p>
<p>Const：表示通过索引一次就找到了const用于比较primary key或者unique索引。因为只匹配一行数据，所以很快</p>
<p>eq_ref ：唯一性索引扫描，对于每个索引键，表中只有一条记录与之匹配。常见于主键或唯一索引扫描</p>
<p>Ref： 非唯一性索引扫描，返回匹配某个单独值的所有行.本质上也是一种索引访问，它返回所有匹配某个单独值的行，然而，它可能会找到多个符合条件的行，所以他应该属于查找和扫描的混合体</p>
<p>Range： 只检索给定范围的行,使用一个索引来选择行。key 列显示使用了哪个索引，一般就是在你的where语句中出现between、&lt;、&gt;、in等的查询这种范围扫描索引扫描比全表扫描要好，因为它只需要开始于索引的某一点，而结束语另一点，不用扫描全部索引。</p>
<p> Index：当查询的结果全为索引列的时候，虽然也是全部扫描，但是只查询的索引库，而没有去查询数据。</p>
<p>All： Full Table Scan，将遍历全表以找到匹配的行</p>
<p><strong>5.possible_keys 与Key列</strong></p>
<p>possible_keys:可能使用的索引</p>
<p>Key:实际使用的索引。如果为NULL，则没有使用索引</p>
<p> <strong>6.key_len</strong></p>
<p>Key_len表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度。在不损失精确性的情况下，长度越短越好，key_len显示的值为索引字段的最大可能长度，并非实际使用长度，即key_len是根据表定义计算而得，不是通过表内检索出的</p>
<h2 id="sql优化"><a href="#sql优化" class="headerlink" title="sql优化"></a>sql优化</h2><p><strong>尽量全值匹配 ：</strong> 如果可以匹配条件越多越好</p>
<p><strong>最佳左前缀：</strong>让索引不失效的一个策略，也就是使用索引时，第一个索引字段一定要存在，如果第一个索引字段不存在则会出现索引失效问题</p>
<p><strong>不在索引列上做任何操作：</strong>（计算、函数、(自动or手动)类型转换），会导致索引失效而转向全表扫描</p>
<p><strong>范围条件放最后：</strong>中间有范围查询会导致后面的索引列全部失效</p>
<p><strong>覆盖索引尽量用</strong>：尽量使用覆盖索引(只访问索引的而不去访问整张表数据的查询(索引列和查询列一致) )，减少select *</p>
<p><strong>不等于要甚用</strong>：在使用不等于(!= 或者&lt;&gt;)的时候无法使用索引会导致全表扫描</p>
<p><strong>Null/Not 有影响：</strong>null/not null对索引的可能影响</p>
<p><strong>Like查询要当心：</strong>like以通配符开头(‘%abc…’)mysql索引失效会变成全表扫描的操作</p>
<p><strong>字符类型加引号：</strong>字符串不加单引号索引失效</p>
<p><strong>OR改UNION效率高：</strong>在使用or的时候尽量更换为union  </p>
<h2 id="sql函数相关拓展"><a href="#sql函数相关拓展" class="headerlink" title="sql函数相关拓展"></a>sql函数相关拓展</h2><h4 id="一、数学函数"><a href="#一、数学函数" class="headerlink" title="一、数学函数"></a>一、数学函数</h4><p>ABS(x)   返回x的绝对值<br>BIN(x)   返回x的二进制（OCT返回八进制，HEX返回十六进制）<br>CEILING(x)   返回大于x的最小整数值<br>EXP(x)   返回值e（自然对数的底）的x次方<br>FLOOR(x)   返回小于x的最大整数值<br>GREATEST(x1,x2,…,xn)返回集合中最大的值<br>LEAST(x1,x2,…,xn)      返回集合中最小的值<br>LN(x)                    返回x的自然对数<br>LOG(x,y)返回x的以y为底的对数<br>MOD(x,y)                 返回x/y的模（余数）<br>PI()返回pi的值（圆周率）<br>RAND()返回０到１内的随机值,可以通过提供一个参数(种子)使RAND()随机数生成器生成一个指定的值。<br>ROUND(x,y)返回参数x的四舍五入的有y位小数的值<br>SIGN(x) 返回代表数字x的符号的值<br>SQRT(x) 返回一个数的平方根<br>TRUNCATE(x,y)            返回数字x截短为y位小数的结果</p>
<h4 id="二、聚合函数-常用于GROUP-BY从句的SELECT查询中"><a href="#二、聚合函数-常用于GROUP-BY从句的SELECT查询中" class="headerlink" title="二、聚合函数(常用于GROUP BY从句的SELECT查询中)"></a>二、聚合函数(常用于GROUP BY从句的SELECT查询中)</h4><p>AVG(col)返回指定列的平均值<br>COUNT(col)返回指定列中非NULL值的个数<br>MIN(col)返回指定列的最小值<br>MAX(col)返回指定列的最大值<br>SUM(col)返回指定列的所有值之和<br>GROUP_CONCAT(col) 返回由属于一组的列值连接组合而成的结果</p>
<h4 id="三、字符串函数"><a href="#三、字符串函数" class="headerlink" title="三、字符串函数"></a>三、字符串函数</h4><p>ASCII(char)返回字符的ASCII码值<br>BIT_LENGTH(str)返回字符串的比特长度<br>CONCAT(s1,s2…,sn)将s1,s2…,sn连接成字符串<br>CONCAT_WS(sep,s1,s2…,sn)将s1,s2…,sn连接成字符串，并用sep字符间隔<br>INSERT(str,x,y,instr) 将字符串str从第x位置开始，y个字符长的子串替换为字符串instr，返回结果<br>FIND_IN_SET(str,list)分析逗号分隔的list列表，如果发现str，返回str在list中的位置<br>LCASE(str)或LOWER(str) 返回将字符串str中所有字符改变为小写后的结果<br>LEFT(str,x)返回字符串str中最左边的x个字符<br>LENGTH(s)返回字符串str中的字符数<br>LTRIM(str) 从字符串str中切掉开头的空格<br>POSITION(substr,str) 返回子串substr在字符串str中第一次出现的位置<br>QUOTE(str) 用反斜杠转义str中的单引号<br>REPEAT(str,srchstr,rplcstr)返回字符串str重复x次的结果<br>REVERSE(str) 返回颠倒字符串str的结果<br>RIGHT(str,x) 返回字符串str中最右边的x个字符<br>RTRIM(str) 返回字符串str尾部的空格<br>STRCMP(s1,s2)比较字符串s1和s2<br>TRIM(str)去除字符串首部和尾部的所有空格<br>UCASE(str)或UPPER(str) 返回将字符串str中所有字符转变为大写后的结果</p>
<h4 id="四、日期和时间函数"><a href="#四、日期和时间函数" class="headerlink" title="四、日期和时间函数"></a>四、日期和时间函数</h4><p>CURDATE()或CURRENT_DATE() 返回当前的日期<br>CURTIME()或CURRENT_TIME() 返回当前的时间<br>DATE_ADD(date,INTERVAL int keyword)返回日期date加上间隔时间int的结果(int必须按照关键字进行格式化),如：SELECTDATE_ADD(CURRENT_DATE,INTERVAL 6 MONTH);<br>DATE_FORMAT(date,fmt)  依照指定的fmt格式格式化日期date值<br>DATE_SUB(date,INTERVAL int keyword)返回日期date加上间隔时间int的结果(int必须按照关键字进行格式化),如：SELECTDATE_SUB(CURRENT_DATE,INTERVAL 6 MONTH);<br>DAYOFWEEK(date)   返回date所代表的一星期中的第几天(1<del>7)<br>DAYOFMONTH(date)  返回date是一个月的第几天(1</del>31)<br>DAYOFYEAR(date)   返回date是一年的第几天(1<del>366)<br>DAYNAME(date)   返回date的星期名，如：SELECT DAYNAME(CURRENT_DATE);<br>FROM_UNIXTIME(ts,fmt)  根据指定的fmt格式，格式化UNIX时间戳ts<br>HOUR(time)   返回time的小时值(0</del>23)<br>MINUTE(time)   返回time的分钟值(0<del>59)<br>MONTH(date)   返回date的月份值(1</del>12)<br>MONTHNAME(date)   返回date的月份名，如：SELECT MONTHNAME(CURRENT_DATE);<br>NOW()    返回当前的日期和时间<br>QUARTER(date)   返回date在一年中的季度(1<del>4)，如SELECT QUARTER(CURRENT_DATE);<br>WEEK(date)   返回日期date为一年中第几周(0</del>53)<br>YEAR(date)   返回日期date的年份(1000~9999)<br>一些示例：<br>获取当前系统时间：SELECT FROM_UNIXTIME(UNIX_TIMESTAMP());<br>SELECT EXTRACT(YEAR_MONTH FROM CURRENT_DATE);<br>SELECT EXTRACT(DAY_SECOND FROM CURRENT_DATE);<br>SELECT EXTRACT(HOUR_MINUTE FROM CURRENT_DATE);<br>返回两个日期值之间的差值(月数)：SELECT PERIOD_DIFF(200302,199802);<br>在Mysql中计算年龄：<br>SELECT DATE_FORMAT(FROM_DAYS(TO_DAYS(NOW())-TO_DAYS(birthday)),’%Y’)+0 AS age FROM employee;<br>这样，如果Brithday是未来的年月日的话，计算结果为0。<br>下面的SQL语句计算员工的绝对年龄，即当Birthday是未来的日期时，将得到负值。<br>SELECT DATE_FORMAT(NOW(), ‘%Y’) - DATE_FORMAT(birthday, ‘%Y’) -(DATE_FORMAT(NOW(), ‘00-%m-%d’) &lt;DATE_FORMAT(birthday, ‘00-%m-%d’)) AS age from employee</p>
<h4 id="五、加密函数"><a href="#五、加密函数" class="headerlink" title="五、加密函数"></a>五、加密函数</h4><p>AES_ENCRYPT(str,key)  返回用密钥key对字符串str利用高级加密标准算法加密后的结果，调用AES_ENCRYPT的结果是一个二进制字符串，以BLOB类型存储<br>AES_DECRYPT(str,key)  返回用密钥key对字符串str利用高级加密标准算法解密后的结果<br>DECODE(str,key)   使用key作为密钥解密加密字符串str<br>ENCRYPT(str,salt)   使用UNIXcrypt()函数，用关键词salt(一个可以惟一确定口令的字符串，就像钥匙一样)加密字符串str<br>ENCODE(str,key)   使用key作为密钥加密字符串str，调用ENCODE()的结果是一个二进制字符串，它以BLOB类型存储<br>MD5()    计算字符串str的MD5校验和<br>PASSWORD(str)   返回字符串str的加密版本，这个加密过程是不可逆转的，和UNIX密码加密过程使用不同的算法。<br>SHA()    计算字符串str的安全散列算法(SHA)校验和<br>示例：<br>SELECT ENCRYPT(‘root’,’salt’);<br>SELECT ENCODE(‘xufeng’,’key’);<br>SELECT DECODE(ENCODE(‘xufeng’,’key’),’key’);#加解密放在一起<br>SELECT AES_ENCRYPT(‘root’,’key’);<br>SELECT AES_DECRYPT(AES_ENCRYPT(‘root’,’key’),’key’);<br>SELECT MD5(‘123456’);<br>SELECT SHA(‘123456’);</p>
<h4 id="六、控制流函数"><a href="#六、控制流函数" class="headerlink" title="六、控制流函数"></a>六、控制流函数</h4><p>MySQL有4个函数是用来进行条件操作的，这些函数可以实现SQL的条件逻辑，允许开发者将一些应用程序业务逻辑转换到数据库后台。<br>MySQL控制流函数：<br>CASE WHEN[test1] THEN [result1]…ELSE [default] END如果testN是真，则返回resultN，否则返回default<br>CASE [test] WHEN[val1] THEN [result]…ELSE [default]END  如果test和valN相等，则返回resultN，否则返回default<br>IF(test,t,f)   如果test是真，返回t；否则返回f<br>IFNULL(arg1,arg2) 如果arg1不是空，返回arg1，否则返回arg2<br>NULLIF(arg1,arg2) 如果arg1=arg2返回NULL；否则返回arg1<br>这些函数的第一个是IFNULL()，它有两个参数，并且对第一个参数进行判断。如果第一个参数不是NULL，函数就会向调用者返回第一个参数；如果是NULL,将返回第二个参数。<br>如：SELECT IFNULL(1,2), IFNULL(NULL,10),IFNULL(4*NULL,’false’);<br>NULLIF()函数将会检验提供的两个参数是否相等，如果相等，则返回NULL，如果不相等，就返回第一个参数。<br>如：SELECT NULLIF(1,1),NULLIF(‘A’,’B’),NULLIF(2+3,4+1);<br>和许多脚本语言提供的IF()函数一样，MySQL的IF()函数也可以建立一个简单的条件测试，这个函数有三个参数，第一个是要被判断的表达式，如果表达式为真，IF()将会返回第二个参数，如果为假，IF()将会返回第三个参数。<br>如：SELECTIF(1&lt;10,2,3),IF(56&gt;100,’true’,’false’);<br>IF()函数在只有两种可能结果时才适合使用。然而，在现实世界中，我们可能发现在条件测试中会需要多个分支。在这种情况下，MySQL提供了CASE函数，它和PHP及Perl语言的switch-case条件例程一样。<br>CASE函数的格式有些复杂，通常如下所示：<br>CASE [expression to be evaluated]<br>WHEN [val 1] THEN [result 1]<br>WHEN [val 2] THEN [result 2]<br>WHEN [val 3] THEN [result 3]<br>……<br>WHEN [val n] THEN [result n]<br>ELSE [default result]<br>END<br>这里，第一个参数是要被判断的值或表达式，接下来的是一系列的WHEN-THEN块，每一块的第一个参数指定要比较的值，如果为真，就返回结果。所有的WHEN-THEN块将以ELSE块结束，当END结束了所有外部的CASE块时，如果前面的每一个块都不匹配就会返回ELSE块指定的默认结果。如果没有指定ELSE块，而且所有的WHEN-THEN比较都不是真，MySQL将会返回NULL。<br>CASE函数还有另外一种句法，有时使用起来非常方便，如下：<br>CASE<br>WHEN [conditional test 1] THEN [result 1]<br>WHEN [conditional test 2] THEN [result 2]<br>ELSE [default result]<br>END<br>这种条件下，返回的结果取决于相应的条件测试是否为真。<br>示例：<br>mysql&gt;SELECT CASE ‘green’<br>     WHEN ‘red’ THEN ‘stop’<br>     WHEN ‘green’ THEN ‘go’ END;<br>SELECT CASE 9 WHEN 1 THEN ‘a’ WHEN 2 THEN ‘b’ ELSE ‘N/A’ END;<br>SELECT CASE WHEN (2+2)=4 THEN ‘OK’ WHEN(2+2)&lt;&gt;4 THEN ‘not OK’ END ASSTATUS;<br>SELECT Name,IF((IsActive = 1),’已激活’,’未激活’) AS RESULT FROMUserLoginInfo;<br>SELECT fname,lname,(math+sci+lit) AS total,<br>CASE WHEN (math+sci+lit) &lt; 50 THEN ‘D’<br>WHEN (math+sci+lit) BETWEEN 50 AND 150 THEN ‘C’<br>WHEN (math+sci+lit) BETWEEN 151 AND 250 THEN ‘B’<br>ELSE ‘A’ END<br>AS grade FROM marks;<br>SELECT IF(ENCRYPT(‘sue’,’ts’)=upass,’allow’,’deny’) AS LoginResultFROM users WHERE uname = ‘sue’;#一个登陆验证</p>
<h4 id="七、格式化函数"><a href="#七、格式化函数" class="headerlink" title="七、格式化函数"></a>七、格式化函数</h4><p>DATE_FORMAT(date,fmt)  依照字符串fmt格式化日期date值<br>FORMAT(x,y)   把x格式化为以逗号隔开的数字序列，y是结果的小数位数<br>INET_ATON(ip)   返回IP地址的数字表示<br>INET_NTOA(num)   返回数字所代表的IP地址<br>TIME_FORMAT(time,fmt)  依照字符串fmt格式化时间time值<br>其中最简单的是FORMAT()函数，它可以把大的数值格式化为以逗号间隔的易读的序列。<br>示例：<br>SELECT FORMAT(34234.34323432,3);<br>SELECT DATE_FORMAT(NOW(),’%W,%D %M %Y %r’);<br>SELECT DATE_FORMAT(NOW(),’%Y-%m-%d’);<br>SELECT DATE_FORMAT(19990330,’%Y-%m-%d’);<br>SELECT DATE_FORMAT(NOW(),’%h:%i %p’);<br>SELECT INET_ATON(‘10.122.89.47’);<br>SELECT INET_NTOA(175790383);</p>
<h4 id="八、类型转化函数"><a href="#八、类型转化函数" class="headerlink" title="八、类型转化函数"></a>八、类型转化函数</h4><p>为了进行数据类型转化，MySQL提供了CAST()函数，它可以把一个值转化为指定的数据类型。类型有：BINARY,CHAR,DATE,TIME,DATETIME,SIGNED,UNSIGNED<br>示例：<br>SELECT CAST(NOW() AS SIGNED INTEGER),CURDATE()+0;<br>SELECT ‘f’=BINARY ‘F’,’f’=CAST(‘F’ AS BINARY);</p>
<h4 id="九、系统信息函数"><a href="#九、系统信息函数" class="headerlink" title="九、系统信息函数"></a>九、系统信息函数</h4><p>DATABASE()   返回当前数据库名<br>BENCHMARK(count,expr)  将表达式expr重复运行count次<br>CONNECTION_ID()   返回当前客户的连接ID<br>FOUND_ROWS()   返回最后一个SELECT查询进行检索的总行数<br>USER()或SYSTEM_USER()  返回当前登陆用户名<br>VERSION()   返回MySQL服务器的版本<br>示例：<br>SELECT DATABASE(),VERSION(),USER();<br>SELECTBENCHMARK(9999999,LOG(RAND()<em>PI()));#该例中,MySQL计算LOG(RAND()</em>PI())表达式9999999次。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%BA%95%E5%B1%82%E6%B7%B1%E5%85%A5/" rel="tag"># 底层深入</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2020/05/15/Elastic-Stack%E7%9B%B8%E5%85%B3/" rel="next" title="Elastic-Stack相关">
                  <i class="fa fa-chevron-left"></i> Elastic-Stack相关
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="gitalk-container"></div>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#sql架构与存储引擎"><span class="nav-number">1.</span> <span class="nav-text">sql架构与存储引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Qps与Tps"><span class="nav-number">1.1.</span> <span class="nav-text">Qps与Tps</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysqlslap"><span class="nav-number">1.2.</span> <span class="nav-text">mysqlslap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL逻辑架构"><span class="nav-number">1.3.</span> <span class="nav-text">MySQL逻辑架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mylsam存储引擎"><span class="nav-number">1.4.</span> <span class="nav-text">mylsam存储引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#innodb存储引擎"><span class="nav-number">1.5.</span> <span class="nav-text">innodb存储引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSV存储引擎"><span class="nav-number">1.6.</span> <span class="nav-text">CSV存储引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Archive存储引擎"><span class="nav-number">1.7.</span> <span class="nav-text">Archive存储引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory-存储引擎"><span class="nav-number">1.8.</span> <span class="nav-text">Memory 存储引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ferderated-存储引擎"><span class="nav-number">1.9.</span> <span class="nav-text">Ferderated 存储引擎</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql锁机制"><span class="nav-number">2.</span> <span class="nav-text">sql锁机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL中的锁"><span class="nav-number">2.1.</span> <span class="nav-text">MySQL中的锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#myisam的表锁"><span class="nav-number">2.2.</span> <span class="nav-text">myisam的表锁</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#读锁"><span class="nav-number">2.2.1.</span> <span class="nav-text">读锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#写锁"><span class="nav-number">2.2.2.</span> <span class="nav-text">写锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结"><span class="nav-number">2.2.3.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#innoDB行锁"><span class="nav-number">2.3.</span> <span class="nav-text">innoDB行锁</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql事务"><span class="nav-number">3.</span> <span class="nav-text">sql事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#事务的特性"><span class="nav-number">3.1.</span> <span class="nav-text">事务的特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事务隔离级别"><span class="nav-number">3.2.</span> <span class="nav-text">事务隔离级别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql业务设计"><span class="nav-number">4.</span> <span class="nav-text">sql业务设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#范式设计-三大范式"><span class="nav-number">4.1.</span> <span class="nav-text">范式设计 三大范式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#反范式设计"><span class="nav-number">4.2.</span> <span class="nav-text">反范式设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#什么叫反范式化设计"><span class="nav-number">4.2.1.</span> <span class="nav-text">什么叫反范式化设计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#反范式化设计优缺点"><span class="nav-number">4.2.2.</span> <span class="nav-text">反范式化设计优缺点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#物理设计"><span class="nav-number">5.</span> <span class="nav-text">物理设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#命名规范"><span class="nav-number">5.1.</span> <span class="nav-text">命名规范</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#存储引擎选择"><span class="nav-number">5.2.</span> <span class="nav-text">存储引擎选择</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据类型选择"><span class="nav-number">5.3.</span> <span class="nav-text">数据类型选择</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql慢查询"><span class="nav-number">6.</span> <span class="nav-text">sql慢查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是慢查询"><span class="nav-number">6.1.</span> <span class="nav-text">什么是慢查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-1-慢查询基本配置"><span class="nav-number">6.2.</span> <span class="nav-text">1.1.1.    慢查询基本配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql索引与执行计划"><span class="nav-number">7.</span> <span class="nav-text">sql索引与执行计划</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#生活中的索引"><span class="nav-number">7.1.</span> <span class="nav-text">生活中的索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySql中的索引"><span class="nav-number">7.2.</span> <span class="nav-text">MySql中的索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#索引的分类"><span class="nav-number">7.3.</span> <span class="nav-text">索引的分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基础语法"><span class="nav-number">7.4.</span> <span class="nav-text">基础语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行计划"><span class="nav-number">7.5.</span> <span class="nav-text">执行计划</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#执行计划详解"><span class="nav-number">7.5.1.</span> <span class="nav-text">执行计划详解</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql优化"><span class="nav-number">8.</span> <span class="nav-text">sql优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql函数相关拓展"><span class="nav-number">9.</span> <span class="nav-text">sql函数相关拓展</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一、数学函数"><span class="nav-number">9.0.1.</span> <span class="nav-text">一、数学函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二、聚合函数-常用于GROUP-BY从句的SELECT查询中"><span class="nav-number">9.0.2.</span> <span class="nav-text">二、聚合函数(常用于GROUP BY从句的SELECT查询中)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#三、字符串函数"><span class="nav-number">9.0.3.</span> <span class="nav-text">三、字符串函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#四、日期和时间函数"><span class="nav-number">9.0.4.</span> <span class="nav-text">四、日期和时间函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#五、加密函数"><span class="nav-number">9.0.5.</span> <span class="nav-text">五、加密函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#六、控制流函数"><span class="nav-number">9.0.6.</span> <span class="nav-text">六、控制流函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#七、格式化函数"><span class="nav-number">9.0.7.</span> <span class="nav-text">七、格式化函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#八、类型转化函数"><span class="nav-number">9.0.8.</span> <span class="nav-text">八、类型转化函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#九、系统信息函数"><span class="nav-number">9.0.9.</span> <span class="nav-text">九、系统信息函数</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="DSZ"
      src="/images/dsz.jpeg">
  <p class="site-author-name" itemprop="name">DSZ</p>
  <div class="site-description" itemprop="description">机会是留给有准备的人的。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-DSZ"></i>
  </span>
 
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>













  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '',
      clientSecret: '',
      repo: '',
      owner: '',
      admin: [''],
      id: 'b46e833c38e56604c3f27be48d924f7d',
        language: 'zh-CN',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script>

</body>
</html>
